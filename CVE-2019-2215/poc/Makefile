#
# Makefile for CVE-2019-2215 in emulator
# NDK_ROOT = /path/to/ndk make
# 

CXX             := clang++
CXXFLAGS        := -static -O3 -Wall -Wextra

ARCH            := x86_64
NDK_API         ?= 29
CROSS_COMPILE   := $(NDK_ROOT)/toolchains/llvm/prebuilt/darwin-x86_64
TARGET_PLATFORM := $(ARCH)-linux-android

CXX_PATH        := $(CROSS_COMPILE)/bin/$(TARGET_PLATFORM)$(NDK_API)-$(CXX)

EXPLORE_SRC     := explore.cpp
EXPLORE_OUTPUT  := n1rv0us_pwn
EXPLOIT_SRC     := exploit.cpp
EXPLOIT_OUTPUT  := n1rv0us_exploit

# default rules
default: all

# phony rules
.PHONY: all

all: clean build-explore build-exploit

clean:
	@echo Removing: $(EXPLORE_OUTPUT)
	@rm -f $(EXPLORE_OUTPUT)
	@echo Removing: $(EXPLOIT_OUTPUT)
	@rm -f $(EXPLOIT_OUTPUT)

build-explore:
	@echo Building: $(EXPLORE_OUTPUT)
	@$(CXX_PATH) $(CXXFLAGS) -o $(EXPLORE_OUTPUT) $(EXPLORE_SRC)

build-exploit:
	@echo Building: $(EXPLOIT_OUTPUT)
	@$(CXX_PATH) $(CXXFLAGS) -o $(EXPLOIT_OUTPUT) $(EXPLOIT_SRC)